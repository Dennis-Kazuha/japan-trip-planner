
<!DOCTYPE html>
<html lang="zh-TW">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>æ—¥æœ¬æ—…éŠè¦åŠƒèˆ‡éµè·¯ç³»çµ±</title>
   <!-- è¼‰å…¥ Tailwind CSS CDN -->
   <script src="https://cdn.tailwindcss.com"></script>
   <!-- è¼‰å…¥ Vue 3 CDN -->
   <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
   <!-- è¼‰å…¥ FontAwesome Icons -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
   <style>
       /* ä½¿ç”¨ Inter å­—é«”ä»¥ç²å¾—ç¾ä»£ App æ„Ÿ */
       :root { font-family: 'Inter', sans-serif; }
       /* éš±è—åŸç”Ÿæ»¾å‹•æ¢ï¼Œä½†ä¿ç•™æ»¾å‹•åŠŸèƒ½ */
       .no-scrollbar::-webkit-scrollbar { display: none; }
       .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
       /* LE SSERAFIM ä¸»é¡Œè‰² (ç´…é»‘/ç™½è‰²èª¿) */
       .app-primary { background-color: #f7004f; } /* é¡ä¼¼ 'Fearless' çš„ç´…è‰² */
       .app-secondary { background-color: #3f3f46; } /* Gray-700 */
       .app-text-primary { color: #f7004f; }
       .app-bg { background-color: #f4f4f5; } /* Zinc-100 */

       /* æ¨¡æ“¬æ‰‹æ©Ÿé ‚éƒ¨ç‹€æ…‹æ¬„ */
       .status-bar {
           height: 24px;
           background-color: #fff;
           border-radius: 12px 12px 0 0;
           box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
       }
   </style>
   <script>
       tailwind.config = {
           theme: {
               extend: {
                   colors: {
                       'primary': '#f7004f',
                       'secondary': '#3f3f46',
                       'background': '#f4f4f5',
                   }
               }
           }
       }
   </script>
</head>
<body class="bg-background min-h-screen">

<div id="app" class="max-w-md mx-auto shadow-2xl bg-white min-h-screen flex flex-col">
   <!-- æ¨¡æ“¬æ‰‹æ©Ÿé‚Šæ¡†çš„ç‹€æ…‹æ¬„ -->
   <div class="status-bar"></div>

   <!-- å°é¢å€åŸŸ (LE SSERAFIM Logo ä¸»é¡Œ) -->
   <div class="app-secondary text-white p-6 rounded-b-xl shadow-lg relative overflow-hidden">
       <h1 class="text-3xl font-extrabold tracking-widest text-center mb-1">
           FEARLESS JOURNEY
       </h1>
       <p class="text-sm text-center font-light tracking-wider opacity-80 mb-4">
           æ—¥æœ¬æ—…éŠè¨ˆåŠƒ
       </p>

       <!-- è¦–è¦ºå…ƒç´ ï¼šæ¨¡ä»¿ logo çš„ç°¡ç´„ç·šæ¢è¨­è¨ˆ -->
       <div class="flex justify-center space-x-4 text-primary text-xl">
           <i class="fas fa-route"></i>
           <i class="fas fa-cloud-sun"></i>
           <i class="fas fa-wallet"></i>
           <i class="fas fa-train"></i>
       </div>
   </div>

   <!-- å…§å®¹å€å¡Šèˆ‡ Tab åˆ‡æ› -->
   <header class="sticky top-0 z-10 bg-white p-2 border-b border-gray-200">
       <div class="flex justify-around p-1 bg-gray-100 rounded-xl shadow-inner">
           <button
               v-for="tab in tabs"
               :key="tab.id"
               @click="currentTab = tab.id"
               :class="{'app-primary shadow-lg text-white': currentTab === tab.id, 'text-gray-600': currentTab !== tab.id}"
               class="flex-1 py-2 rounded-lg font-medium transition-all duration-300 flex items-center justify-center space-x-2 text-sm"
           >
               <i :class="tab.icon"></i>
               <span class="hidden sm:inline">{{ tab.name }}</span>
           </button>
       </div>
   </header>

   <!-- å…§å®¹å€åŸŸ -->
   <main class="flex-grow p-4 overflow-y-auto no-scrollbar">

       <!-- 1. æ¯æ—¥è¡Œç¨‹è¡¨ (Itinerary) -->
       <div v-if="currentTab === 'itinerary'" class="space-y-6">
           <h2 class="text-2xl font-bold app-text-primary border-b pb-2">ğŸ“… æ¯æ—¥è¡Œç¨‹è¦åŠƒ</h2>

           <!-- è¡Œç¨‹æ–°å¢è¡¨å–® -->
           <form @submit.prevent="addActivity" class="bg-white p-4 shadow-xl rounded-2xl border border-primary/10 space-y-3">
               <input v-model="newActivity.time" type="time" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150">
               <input v-model="newActivity.location" type="text" placeholder="åœ°é» (å¦‚ï¼šæ±äº¬éµå¡”)" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
               <textarea v-model="newActivity.details" placeholder="å‚™è¨» (å¦‚ï¼šé–€ç¥¨å·²è³¼è²·)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary resize-none" rows="2"></textarea>
               <button type="submit" class="app-primary text-white w-full py-3 rounded-xl font-semibold shadow-md hover:shadow-lg transition duration-200">
                   <i class="fas fa-plus mr-2"></i> æ–°å¢æ´»å‹•
               </button>
           </form>

           <!-- è¡Œç¨‹åˆ—è¡¨ -->
           <div v-if="sortedSchedule.length === 0" class="text-center p-8 bg-white rounded-2xl shadow-md text-gray-500">
               <i class="far fa-calendar-alt text-4xl mb-3 app-text-primary"></i>
               <p>ç„¡ç•åœ°æ–°å¢ä½ çš„è¡Œç¨‹å§ï¼</p>
           </div>

           <div v-else class="space-y-4">
               <div v-for="(activity, index) in sortedSchedule" :key="activity.id" class="relative pl-6">
                   <!-- æ™‚é–“ç·šé» -->
                   <div class="absolute left-0 top-0 w-3 h-3 app-primary rounded-full ring-4 ring-primary/30"></div>
                   <!-- æ™‚é–“ç·š -->
                   <div v-if="index < dailySchedule.length - 1" class="absolute left-[5px] top-4 bottom-[-10px] w-0.5 bg-primary/50"></div>

                   <div :class="{'bg-red-50/70 border-primary/40': activity.editing}" class="bg-white p-4 rounded-xl shadow-md transition-all duration-300 border border-transparent">
                       <div v-if="!activity.editing" @click="toggleEdit(activity)" class="cursor-pointer">
                           <p class="font-bold text-lg app-text-primary">{{ activity.time }}</p>
                           <h3 class="font-semibold text-gray-800 text-xl">{{ activity.location }}</h3>
                           <p v-if="activity.details" class="text-sm text-gray-600 mt-1 italic">{{ activity.details }}</p>
                           <div class="mt-2 text-right">
                               <button @click.stop="deleteActivity(activity.id)" class="text-red-500 hover:text-red-700 p-1 rounded transition">
                                   <i class="fas fa-trash-alt"></i> åˆªé™¤
                               </button>
                               <button @click.stop="toggleEdit(activity)" class="text-secondary hover:text-secondary/80 ml-2 p-1 rounded transition">
                                   <i class="fas fa-edit"></i> ç·¨è¼¯
                               </button>
                           </div>
                       </div>
                       <!-- ç·¨è¼¯æ¨¡å¼ -->
                       <div v-else class="space-y-2">
                           <input v-model="activity.time" type="time" class="w-full p-2 border rounded-lg focus:ring-primary focus:border-primary">
                           <input v-model="activity.location" type="text" class="w-full p-2 border rounded-lg focus:ring-primary focus:border-primary">
                           <textarea v-model="activity.details" class="w-full p-2 border rounded-lg resize-none focus:ring-primary focus:border-primary"></textarea>
                           <button @click="toggleEdit(activity)" class="app-primary text-white w-full py-2 rounded-lg font-medium">
                               <i class="fas fa-check mr-2"></i> å®Œæˆç·¨è¼¯
                           </button>
                       </div>
                   </div>
               </div>
           </div>
       </div>

       <!-- 2. åˆ†å¸³ç³»çµ± (Expenses) -->
       <div v-else-if="currentTab === 'expenses'" class="space-y-6">
           <h2 class="text-2xl font-bold app-text-primary border-b pb-2">ğŸ’° æ—…éŠåˆ†å¸³çµç®—</h2>

           <!-- äººå“¡ç®¡ç†èˆ‡æ–°å¢æ”¯å‡º -->
           <div class="bg-white p-4 shadow-xl rounded-2xl border border-primary/10 space-y-4">
               <h3 class="font-semibold text-lg text-gray-700 border-b pb-2">æ—…ä¼´åå–®</h3>
               <div class="flex flex-wrap gap-2 mb-3">
                   <span v-for="person in people" :key="person" class="bg-secondary/10 text-secondary font-medium py-1 px-3 rounded-full flex items-center shadow-sm">
                       {{ person }}
                       <button @click="removePerson(person)" class="ml-2 text-sm text-secondary/70 hover:text-secondary transition">
                           <i class="fas fa-times-circle"></i>
                       </button>
                   </span>
               </div>
               <div class="flex space-x-2">
                   <input v-model="newPersonName" @keyup.enter="addPerson" type="text" placeholder="æ–°å¢æ—…ä¼´åç¨±" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                   <button @click="addPerson" class="app-secondary text-white p-3 rounded-lg font-semibold shadow-md"><i class="fas fa-user-plus"></i></button>
               </div>
           </div>

           <!-- æ–°å¢æ”¯å‡ºè¡¨å–® -->
           <form @submit.prevent="addExpense" class="bg-white p-4 shadow-xl rounded-2xl border border-primary/10 space-y-3">
               <h3 class="font-semibold text-lg text-gray-700 border-b pb-2">è¨˜éŒ„æ–°æ”¯å‡º (JPY)</h3>
               <input v-model.number="newExpense.amount" type="number" placeholder="é‡‘é¡ (JPY)" required min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
               <input v-model="newExpense.description" type="text" placeholder="æ”¯å‡ºé …ç›® (å¦‚ï¼šåˆé¤)" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
               <select v-model="newExpense.paidBy" required class="w-full p-3 border border-gray-300 rounded-lg appearance-none bg-white focus:ring-primary focus:border-primary">
                   <option value="" disabled>èª°ä»˜çš„éŒ¢ï¼Ÿ</option>
                   <option v-for="person in people" :key="person" :value="person">{{ person }}</option>
               </select>

               <p class="font-medium text-gray-700 mt-3">èª°åƒèˆ‡äº†åˆ†å¸³ï¼Ÿ</p>
               <div class="flex flex-wrap gap-3">
                   <label v-for="person in people" :key="person" class="inline-flex items-center bg-gray-100 p-2 rounded-lg shadow-inner">
                       <input type="checkbox" :value="person" v-model="newExpense.participants" class="form-checkbox text-primary rounded focus:ring-primary">
                       <span class="ml-2 text-gray-700 text-sm">{{ person }}</span>
                   </label>
               </div>
               <button type="submit" :disabled="people.length < 2 || newExpense.participants.length === 0" class="app-primary text-white w-full py-3 rounded-xl font-semibold shadow-md hover:shadow-lg transition duration-200 disabled:opacity-50">
                   <i class="fas fa-credit-card mr-2"></i> è¨˜éŒ„æ”¯å‡º
               </button>
           </form>

           <!-- çµç®—çµæœ -->
           <div class="bg-secondary text-white p-4 shadow-xl rounded-2xl">
               <h3 class="font-bold text-xl mb-3 flex justify-between items-center border-b border-white/30 pb-2">
                   <span>çµç®—çµæœ</span>
                   <span class="text-sm font-light opacity-80">ç¸½æ”¯å‡º: {{ totalExpenses.toLocaleString() }} JPY</span>
               </h3>

               <!-- ç¸½çµç®—è¡¨ -->
               <div class="space-y-2 mb-4">
                   <div v-for="(balance, person) in balances" :key="person" class="flex justify-between items-center bg-white/10 p-2 rounded-lg">
                       <span class="font-medium">{{ person }}</span>
                       <span :class="{'text-green-300': balance > 0, 'text-red-300': balance < 0, 'text-white': balance === 0}" class="font-bold">
                           {{ balance > 0 ? '+' : '' }}{{ balance.toLocaleString() }} JPY
                       </span>
                   </div>
               </div>

               <!-- æœ€å°åŒ–äº¤æ˜“å»ºè­° -->
               <h4 class="font-semibold text-lg border-b border-white/30 pb-2 mb-3">æœ€å°åŒ–äº¤æ˜“å»ºè­°</h4>
               <div v-if="settlements.length === 0" class="text-center text-white/70 italic">
                   ç›®å‰ç„¡éœ€çµç®—ã€‚
               </div>
               <div v-else class="space-y-3">
                   <div v-for="(settlement, index) in settlements" :key="index" class="bg-white/20 p-3 rounded-lg flex items-center justify-between shadow-md">
                       <span class="font-medium">{{ settlement.from }}</span>
                       <i class="fas fa-arrow-right mx-2 text-primary"></i>
                       <span class="font-medium">{{ settlement.to }}</span>
                       <span class="ml-auto font-bold text-lg text-primary bg-white px-3 py-1 rounded-full shadow-inner">
                           {{ settlement.amount.toLocaleString() }} JPY
                       </span>
                   </div>
               </div>
           </div>

           <!-- æ”¯å‡ºæ­·å²ç´€éŒ„ -->
           <h3 class="font-bold text-xl app-text-primary border-b pb-2 mt-6">æ”¯å‡ºæ­·å²ç´€éŒ„</h3>
           <div v-if="expenses.length === 0" class="text-center p-8 bg-white rounded-2xl shadow-md text-gray-500">
               <i class="fas fa-receipt text-4xl mb-3 app-text-primary"></i>
               <p>é‚„æ²’æœ‰ä»»ä½•æ”¯å‡ºç´€éŒ„ã€‚</p>
           </div>
           <div v-else class="space-y-3">
               <div v-for="(expense, index) in expenses" :key="index" class="bg-white p-4 rounded-xl shadow-md flex justify-between items-center">
                   <div>
                       <p class="font-semibold text-gray-800">{{ expense.description }}</p>
                       <p class="text-sm text-gray-500">ç”± <span class="font-medium text-secondary">{{ expense.paidBy }}</span> æ”¯ä»˜</p>
                       <p class="text-xs text-gray-400">åƒèˆ‡è€…: {{ expense.participants.join(', ') }}</p>
                   </div>
                   <div class="text-right">
                       <p class="font-bold text-xl app-text-primary">{{ expense.amount.toLocaleString() }} JPY</p>
                       <button @click="deleteExpense(index)" class="text-red-500 hover:text-red-700 text-sm mt-1">
                           <i class="fas fa-trash-alt"></i>
                       </button>
                   </div>
               </div>
           </div>
       </div>

       <!-- 3. éµè·¯ç³»çµ± (Railway) -->
       <div v-else-if="currentTab === 'railway'" class="space-y-6">
           <h2 class="text-2xl font-bold app-text-primary border-b pb-2">ğŸš… æ—¥æœ¬éµè·¯æŸ¥è©¢ (æ¨¡æ“¬)</h2>

           <div class="bg-white p-4 shadow-xl rounded-2xl border border-primary/10 space-y-3">
               <input v-model="railwayOrigin" type="text" placeholder="èµ·é» (å¦‚ï¼šæ±äº¬ç«™)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
               <input v-model="railwayDestination" type="text" placeholder="çµ‚é» (å¦‚ï¼šæ–°å¤§é˜ªç«™)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
               <button @click="searchRailway" :disabled="isLoadingRailway" class="app-primary text-white w-full py-3 rounded-xl font-semibold shadow-md hover:shadow-lg transition duration-200 disabled:opacity-50">
                   <i :class="{'fas fa-search': !isLoadingRailway, 'fas fa-spinner fa-spin': isLoadingRailway}" class="mr-2"></i>
                   {{ isLoadingRailway ? 'æŸ¥è©¢ä¸­...' : 'æŸ¥è©¢è·¯ç·š' }}
               </button>
           </div>

           <div v-if="railwayResults.time" class="bg-white p-4 shadow-xl rounded-2xl border border-primary/10 space-y-3">
               <h3 class="font-bold text-xl text-secondary border-b pb-2">æŸ¥è©¢çµæœ</h3>
               <div class="flex justify-between items-center">
                   <span class="text-gray-600"><i class="fas fa-clock mr-2 app-text-primary"></i>æ‰€éœ€æ™‚é–“</span>
                   <span class="font-bold text-lg">{{ railwayResults.time }}</span>
               </div>
               <div class="flex justify-between items-center">
                   <span class="text-gray-600"><i class="fas fa-yen-sign mr-2 app-text-primary"></i>é ä¼°ç¥¨åƒ¹</span>
                   <span class="font-bold text-lg">{{ railwayResults.fare.toLocaleString() }} JPY</span>
               </div>
               <div class="flex justify-between items-center">
                   <span class="text-gray-600"><i class="fas fa-exchange-alt mr-2 app-text-primary"></i>è½‰ä¹˜æ¬¡æ•¸</span>
                   <span class="font-bold text-lg">{{ railwayResults.transfers }} æ¬¡</span>
               </div>
               <button @click="openTransitMap" class="app-secondary text-white w-full py-3 rounded-xl font-semibold shadow-md hover:shadow-lg transition duration-200 mt-3">
                   <i class="fas fa-map-marked-alt mr-2"></i> åœ¨ Google åœ°åœ–ä¸ŠæŸ¥çœ‹
               </button>
           </div>
       </div>

       <!-- 4. å¤©æ°£èˆ‡åœ°åœ– (Weather & Map) -->
       <div v-else-if="currentTab === 'weather'" class="space-y-6">
           <h2 class="text-2xl font-bold app-text-primary border-b pb-2">â˜€ï¸ å¤©æ°£èˆ‡åœ°åœ–</h2>

           <!-- å¤©æ°£æŸ¥è©¢ -->
           <div class="bg-white p-4 shadow-xl rounded-2xl border border-primary/10 space-y-3">
               <h3 class="font-semibold text-lg text-gray-700 border-b pb-2">åŸå¸‚å¤©æ°£æŸ¥è©¢ (æ¨¡æ“¬)</h3>
               <div class="flex space-x-2">
                   <input v-model="weatherQuery" @keyup.enter="getWeather" type="text" placeholder="è¼¸å…¥åŸå¸‚åç¨± (å¦‚ï¼šæ±äº¬)" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                   <button @click="getWeather" :disabled="isLoadingWeather" class="app-primary text-white p-3 rounded-lg font-semibold shadow-md">
                       <i :class="{'fas fa-search': !isLoadingWeather, 'fas fa-spinner fa-spin': isLoadingWeather}"></i>
                   </button>
               </div>

               <div v-if="weatherResult.city" class="text-center p-4 bg-background rounded-xl shadow-inner">
                   <p class="text-sm text-gray-500">{{ weatherResult.date }}</p>
                   <i :class="weatherResult.iconClass" class="text-6xl app-text-primary my-3"></i>
                   <h4 class="text-3xl font-bold text-gray-800">{{ weatherResult.city }}</h4>
                   <p class="text-xl font-medium text-secondary mb-3">{{ weatherResult.description }}</p>

                   <div class="flex justify-around text-sm text-gray-600 border-t pt-3">
                       <div>
                           <p class="font-bold text-lg app-text-primary">{{ weatherResult.temperature }}Â°C</p>
                           <p>ç•¶å‰æº«åº¦</p>
                       </div>
                       <div>
                           <p class="font-bold text-lg">{{ weatherResult.maxTemp }}Â°C / {{ weatherResult.minTemp }}Â°C</p>
                           <p>é«˜ / ä½æº«</p>
                       </div>
                       <div>
                           <p class="font-bold text-lg">{{ weatherResult.humidity }}%</p>
                           <p>æ¿•åº¦</p>
                       </div>
                       <div>
                           <p class="font-bold text-lg">{{ weatherResult.windSpeed }} km/h</p>
                           <p>é¢¨é€Ÿ</p>
                       </div>
                   </div>
               </div>
           </div>

           <!-- åœ°åœ–æŸ¥è©¢ -->
           <div class="bg-white p-4 shadow-xl rounded-2xl border border-primary/10 space-y-3">
               <h3 class="font-semibold text-lg text-gray-700 border-b pb-2">åœ°é»åœ°åœ–æŸ¥è©¢</h3>
               <div class="flex space-x-2">
                   <input v-model="mapQuery" @keyup.enter="openMap" type="text" placeholder="è¼¸å…¥åœ°é»åç¨± (å¦‚ï¼šæ¾€è°·äº¤å‰è·¯å£)" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                   <button @click="openMap" class="app-secondary text-white p-3 rounded-lg font-semibold shadow-md">
                       <i class="fas fa-map-marker-alt"></i>
                   </button>
               </div>
               <p class="text-xs text-gray-500 italic">é»æ“ŠæŒ‰éˆ•å°‡åœ¨æ–°è¦–çª—é–‹å•Ÿ Google åœ°åœ–æŸ¥è©¢ã€‚</p>
           </div>
       </div>

   </main>

   <!-- åº•éƒ¨ç‰ˆæ¬Šè³‡è¨Š -->
   <footer class="p-3 text-center text-xs text-gray-500 border-t">
       <p>Powered by Vue 3 & Tailwind CSS | FEARLESS JOURNEY Â© 2025</p>
   </footer>
</div>

<script>
   const { createApp, ref, reactive, computed } = Vue

   createApp({
       setup() {
           const currentTab = ref('itinerary');
           const tabs = [
               { id: 'itinerary', name: 'è¡Œç¨‹', icon: 'fas fa-route' },
               { id: 'expenses', name: 'åˆ†å¸³', icon: 'fas fa-wallet' },
               { id: 'railway', name: 'éµè·¯', icon: 'fas fa-train' },
               { id: 'weather', name: 'å¤©æ°£', icon: 'fas fa-cloud-sun' },
           ];

           // --- è¡Œç¨‹è¦åŠƒé‚è¼¯ (Itinerary Logic) ---
           const dailySchedule = reactive([
               { id: 1, time: '09:00', location: 'æˆç”°æ©Ÿå ´ (NRT)', details: 'æ­ä¹˜ Skyliner å‰å¾€å¸‚å€', editing: false },
               { id: 2, time: '12:30', location: 'æ–°å®¿å¾¡è‹‘', details: 'é‡é¤åˆé¤', editing: false },
               { id: 3, time: '15:00', location: 'æ±äº¬éƒ½å»³å±•æœ›å°', details: 'å…è²»è§€æ™¯å°', editing: false },
               { id: 4, time: '18:30', location: 'æ­Œèˆä¼ç”º', details: 'æ™šé¤ï¼šä¸€è˜­æ‹‰éºµ', editing: false },
           ]);
           const newActivity = reactive({
               time: '10:00',
               location: '',
               details: ''
           });

           const sortedSchedule = computed(() => {
               return [...dailySchedule].sort((a, b) => {
                   if (a.time < b.time) return -1;
                   if (a.time > b.time) return 1;
                   return 0;
               });
           });

           const addActivity = () => {
               if (newActivity.location) {
                   dailySchedule.push({
                       id: Date.now(),
                       time: newActivity.time,
                       location: newActivity.location,
                       details: newActivity.details,
                       editing: false
                   });
                   newActivity.location = '';
                   newActivity.details = '';
               }
           };

           const deleteActivity = (id) => {
               const index = dailySchedule.findIndex(activity => activity.id === id);
               if (index !== -1) {
                   dailySchedule.splice(index, 1);
               }
           };

           const toggleEdit = (activity) => {
               activity.editing = !activity.editing;
           };

           // --- åˆ†å¸³ç³»çµ±é‚è¼¯ (Expense Logic) ---
           const people = ref(['Manus', 'User', 'Friend A']);
           const newPersonName = ref('');
           const expenses = reactive([
               { amount: 10000, description: 'æ©Ÿç¥¨', paidBy: 'Manus', participants: ['Manus', 'User', 'Friend A'] },
               { amount: 3000, description: 'æ™šé¤', paidBy: 'User', participants: ['Manus', 'User'] },
               { amount: 500, description: 'é£²æ–™', paidBy: 'Friend A', participants: ['Manus', 'User', 'Friend A'] },
           ]);
           const newExpense = reactive({
               amount: null,
               description: '',
               paidBy: '',
               participants: []
           });

           const addPerson = () => {
               const name = newPersonName.value.trim();
               if (name && !people.value.includes(name)) {
                   people.value.push(name);
                   newPersonName.value = '';
               }
           };

           const removePerson = (person) => {
               people.value = people.value.filter(p => p !== person);
               // ç§»é™¤ç›¸é—œæ”¯å‡ºä¸­çš„åƒèˆ‡è€…
               expenses.forEach(expense => {
                   expense.participants = expense.participants.filter(p => p !== person);
                   if (expense.paidBy === person) {
                       expense.paidBy = ''; // å¦‚æœä»˜éŒ¢çš„äººè¢«ç§»é™¤ï¼Œæ¸…ç©ºä»˜éŒ¢äººæ¬„ä½
                   }
               });
           };

           const addExpense = () => {
               if (newExpense.amount && newExpense.description && newExpense.paidBy && newExpense.participants.length > 0) {
                   expenses.push({
                       amount: newExpense.amount,
                       description: newExpense.description,
                       paidBy: newExpense.paidBy,
                       participants: [...newExpense.participants] // è¤‡è£½é™£åˆ—
                   });
                   // é‡ç½®è¡¨å–®
                   newExpense.amount = null;
                   newExpense.description = '';
                   newExpense.paidBy = '';
                   newExpense.participants = [];
               }
           };

           const deleteExpense = (index) => {
               expenses.splice(index, 1);
           };

           const totalExpenses = computed(() => {
               return expenses.reduce((sum, expense) => sum + expense.amount, 0);
           });

           const balances = computed(() => {
               const balanceMap = {};
               people.value.forEach(person => balanceMap[person] = 0);

               expenses.forEach(expense => {
                   const share = expense.amount / expense.participants.length;
                   // æ”¯ä»˜è€…é¤˜é¡å¢åŠ  (å·²ä»˜ - æ‡‰ä»˜)
                   balanceMap[expense.paidBy] += expense.amount;

                   // åƒèˆ‡è€…é¤˜é¡æ¸›å°‘ (æ‡‰ä»˜)
                   expense.participants.forEach(person => {
                       balanceMap[person] -= share;
                   });
               });

               // å››æ¨äº”å…¥åˆ°å°æ•¸é»å¾Œå…©ä½
               for (const person in balanceMap) {
                   balanceMap[person] = Math.round(balanceMap[person] * 100) / 100;
               }

               return balanceMap;
           });

           const settlements = computed(() => {
               const balancesCopy = JSON.parse(JSON.stringify(balances.value)); // æ·±åº¦è¤‡è£½
               const debtors = [];
               const creditors = [];
               const settlements = [];

               for (const person in balancesCopy) {
                   if (balancesCopy[person] < 0) {
                       debtors.push({ name: person, amount: -balancesCopy[person] });
                   } else if (balancesCopy[person] > 0) {
                       creditors.push({ name: person, amount: balancesCopy[person] });
                   }
               }

               let dIndex = 0;
               let cIndex = 0;

               while (dIndex < debtors.length && cIndex < creditors.length) {
                   let debtor = debtors[dIndex];
                   let creditor = creditors[cIndex];

                   const amountToSettle = Math.min(debtor.amount, creditor.amount);

                   if (amountToSettle > 0) {
                       settlements.push({
                           from: debtor.name,
                           to: creditor.name,
                           amount: Math.round(amountToSettle * 100) / 100 // ç¢ºä¿çµç®—é‡‘é¡å››æ¨äº”å…¥
                       });
                   }

                   debtor.amount -= amountToSettle;
                   creditor.amount -= amountToSettle;

                   // ä½¿ç”¨ä¸€å€‹å°å®¹å·®ä¾†é¿å…æµ®é»æ•¸å•é¡Œ
                   if (debtor.amount <= 0.01) { dIndex++; } // ä¿®æ­£å®¹å·®åˆ¤æ–·
                   if (creditor.amount <= 0.01) { cIndex++; } // ä¿®æ­£å®¹å·®åˆ¤æ–·
               }

               return settlements;
           });

           // --- éµè·¯ç³»çµ±é‚è¼¯ (Railway Logic) ---
           const railwayOrigin = ref('æ±äº¬ç«™');
           const railwayDestination = ref('æ–°å¤§é˜ªç«™');
           const isLoadingRailway = ref(false);
           const railwayResults = reactive({
               time: '',
               fare: 0,
               transfers: 0,
           });

           const searchRailway = async () => {
               const origin = railwayOrigin.value.trim();
               const destination = railwayDestination.value.trim();
               if (!origin || !destination) return;

               isLoadingRailway.value = true;
               Object.assign(railwayResults, { time: '', fare: 0, transfers: 0 });

               await new Promise(resolve => setTimeout(resolve, 1800)); // æ¨¡æ“¬ API å»¶é²

               // æ ¹æ“šå¸¸è¦‹è·¯ç·šæ¨¡æ“¬çµæœ
               let time = 'ç´„ 2.5 å°æ™‚';
               let fare = 14000; // æ–°å¹¹ç·šç¥¨åƒ¹
               let transfers = 1;

               if (origin.includes('æ±äº¬') && destination.includes('å¤§é˜ª')) {
                   time = 'ç´„ 2.5 å°æ™‚';
                   fare = 14000;
                   transfers = 1;
               } else if (origin.includes('äº¬éƒ½') && destination.includes('å¤§é˜ª')) {
                   time = 'ç´„ 30 åˆ†é˜';
                   fare = 570;
                   transfers = 0;
               } else if (origin.includes('æ¾€è°·') && destination.includes('æ–°å®¿')) {
                   time = 'ç´„ 10 åˆ†é˜';
                   fare = 160;
                   transfers = 0;
               }

               Object.assign(railwayResults, {
                   time: time,
                   fare: fare,
                   transfers: transfers,
               });

               isLoadingRailway.value = false;
           };

           const openTransitMap = () => {
               const origin = encodeURIComponent(railwayOrigin.value.trim() + ' Japan');
               const destination = encodeURIComponent(railwayDestination.value.trim() + ' Japan');
               // ä½¿ç”¨ Google Maps äº¤é€šæ¨¡å¼é€²è¡Œå°èˆª
               const mapUrl = `https://www.google.com/maps/dir/${origin}/${destination}/data=!4m2!4m1!3e3`;
               window.open(mapUrl, '_blank');
           };

           // --- å¤©æ°£åŠŸèƒ½é‚è¼¯ (Weather Logic) ---
           const weatherQuery = ref('æ±äº¬');
           const isLoadingWeather = ref(false);
           const weatherResult = reactive({
               city: '',
               date: '',
               temperature: '',
               description: '',
               humidity: '',
               windSpeed: '',
               maxTemp: '',
               minTemp: '',
               iconClass: 'fas fa-question-circle'
           });

           // æ¨¡æ“¬å¤©æ°£ API éŸ¿æ‡‰
           const getWeather = async () => {
               const query = weatherQuery.value.trim();
               if (!query) return;

               isLoadingWeather.value = true;
               Object.assign(weatherResult, { city: '', date: '', temperature: '', description: '', humidity: '', windSpeed: '', maxTemp: '', minTemp: '', iconClass: 'fas fa-question-circle' });

               await new Promise(resolve => setTimeout(resolve, 1500)); // æ¨¡æ“¬ API å»¶é²

               const mockData = {
                   'æ±äº¬': { temp: 18, desc: 'æ™´æœ—ç„¡é›²', icon: 'fas fa-sun', hum: 60, wind: 15, max: 22, min: 14 },
                   'å¤§é˜ª': { temp: 24, desc: 'å¤šé›²æ™‚æ™´', icon: 'fas fa-cloud-sun', hum: 75, wind: 10, max: 26, min: 20 },
                   'äº¬éƒ½': { temp: 15, desc: 'é™£é›¨', icon: 'fas fa-cloud-showers-heavy', hum: 85, wind: 8, max: 17, min: 12 },
                   'æœ­å¹Œ': { temp: 5, desc: 'å°é›ª', icon: 'fas fa-snowflake', hum: 70, wind: 20, max: 7, min: 2 },
               };

               const data = mockData[query] || mockData['æ±äº¬']; // å¦‚æœæ‰¾ä¸åˆ°ï¼Œé è¨­ç‚ºæ±äº¬

               Object.assign(weatherResult, {
                   city: query,
                   date: new Date().toLocaleDateString('zh-TW', { year: 'numeric', month: 'short', day: 'numeric' }),
                   temperature: data.temp,
                   description: data.desc,
                   humidity: data.hum,
                   windSpeed: data.wind,
                   maxTemp: data.max,
                   minTemp: data.min,
                   iconClass: data.icon
               });

               isLoadingWeather.value = false;
           };

           // é è¨­è¼‰å…¥æ±äº¬å¤©æ°£
           getWeather();

           // --- åœ°åœ–èˆ‡å°èˆªé‚è¼¯ (Map Logic) ---
           const mapQuery = ref('æ¾€è°·äº¤å‰è·¯å£');

           const openMap = () => {
               if (mapQuery.value.trim()) {
                   const query = encodeURIComponent(mapQuery.value.trim() + ' Japan');
                   const mapUrl = `https://www.google.com/maps/search/?api=1&query=${query}`;
                   window.open(mapUrl, '_blank');
               }
           };


           return {
               currentTab,
               tabs,
               dailySchedule,
               newActivity,
               sortedSchedule,
               addActivity,
               deleteActivity,
               toggleEdit,

               people,
               newPersonName,
               expenses,
               newExpense,
               addPerson,
               removePerson,
               addExpense,
               deleteExpense,
               totalExpenses,
               balances,
               settlements,

               railwayOrigin,
               railwayDestination,
               isLoadingRailway,
               railwayResults,
               searchRailway,
               openTransitMap,

               weatherQuery,
               isLoadingWeather,
               weatherResult,
               getWeather,

               mapQuery,
               openMap,
           };
       }
   }).mount('#app')
</script>

</body>
</html>
